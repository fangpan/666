<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="format-detection" content="telephone=no"/>
	<link rel="stylesheet" type="text/css" href="public/bootstrap-3.3.4/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="public/css/common2.css" />
	<link rel="stylesheet" type="text/css" href="public/css/demo2.css" />

  <title></title>
</head>
<body>
    <div class="container-fluid">
        <div class="bcn">
            <ul class="pager">
                 <li class="previous">
                <a href="javascript:window.history.go(-1);"><img src="public/images/new/left.png" alt="" width="24"></a>
                </li>
                <li class="center-block">华为MATE 10华为MATE 10</li>
            </ul>
        </div>

        <!-- 轮播图 -->
        <div class="touchslider">
            <div class="touchslider-top">
                <div class="touchslider-viewport">
                    <div></div>
                </div>
            </div>

            <div class="touchslider-nav">
                <ul class="pager">
                    <li class="center-block">

                    </li>
                </ul>
            </div>
        </div>

        <div class="product-detail">
         <!-- 规格 -->
            <form method="post" action="choosenum.html" style="border-bottom: 5PX solid #F3F2F1;margin-bottom: 10px;">
                <div class="attribute">
                    <table width="100%">

                        <thead>
                        <tr class="payType">
                            <th>付款方式：<input name="pay_type" type="hidden" value=""></th>
                            <td></td>
                        </tr>
                          <tr class="premoney">
                            <th>预存：<input name="" type="hidden" value=""></th>
                            <td></td>
                        </tr>
                        <tr class="price">
                            <th><div>价格：</div><input name="spec_id" type="hidden" value=""></th>
                            <td><strong class="red"></strong></td>
                        </tr>
                        <tr class="store" style="display: none;">
                            <th>库存：</th>
                            <td><strong class="txt"></strong></td>
                        </tr>
                        </thead>
                        <tbody>

                        </tbody>
                        <tfoot>
                        <tr class="offer">
                            <th>套餐：<input name="offer" type="hidden" value=""></th>
                            <td></td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </form><!-- 规格完 -->

            <div class="cut">
                <div class="row">
                    <div class="col-xs-4 none-padding selected" id="c1">商品详情</div>
                    <div class="col-xs-4 none-padding" id="c2">购买须知</div>
                    <div class="col-xs-4 none-padding" id="c3">售后服务</div>
                </div>
                <div class="content">
                   <div class="cut_c c1" style="">
                       商品详情
                       <img src="public/images/d.jpg" class="img-responsive" alt=""/>
                   </div>
                   <div class="cut_c c2" style="display: none">
                        购买须知
                       <img src="public/images/d.jpg" class="img-responsive" alt=""/>
                   </div>
                   <div class="cut_c c3" style="display: none">
                        售后服务
                       <img src="public/images/d.jpg" class="img-responsive" alt=""/>
                   </div>
                </div>
            </div>
        </div>  
    </div> <!-- container -->
   
    <!-- 底部工具栏 -->
      <div class="app-fixed">
        <div class="container-fluid">
          <div class="app-nav">
            <div class="row">
              <div class="col-xs-3 col-sm-3 appItem">
                  <a target="_blank" href="http://im.189.cn/cw/?cf=1&amp;cid=8024&amp;manid=910"> 
                    <img src="public/images/new/bottom_service.png" alt=""></a>
                    <span>在线客服</span>
              </div>
              <div class="col-xs-3 col-sm-3 appItem">
                <a href="orderSearch.html">
                  <img src="public/images/new/bottom_search.png" alt=""></a>
                  <span>订单查询</span></div>
              <div class="col-xs-6 col-sm-6 appItem pull-right" style="padding-right: 0px;">
                <div style="background:#FF7600;height:46PX;line-height:46PX;color: #FFF;" id="detailNext">
                     下一步
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

</body>
</html>

<script type="text/javascript" src="public/js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="public/bootstrap-3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="public/js/common.js"></script>
<script type="text/javascript" src="public/js/jquery.touchslider.min.js"></script>

<script>
   $("#detailNext").click(function(){
       window.location="choosenum.html"
   })
</script>


<script>
            jQuery(function($) {
                var touchSliderImgWidth=$('.touchslider-viewport').width();
                
                var productImg=['public/images/d.jpg','public/images/d1.jpg','public/images/d3.jpg','public/images/d2.jpg','public/images/d2.jpg'];

                $.each(productImg,function(key,val){
                    $('.touchslider').find('.touchslider-viewport > div').append('<div class="touchslider-item"><img style="max-width:'+touchSliderImgWidth+'px " src="'+val+'" class="" alt=""/></div>');
                    $('.touchslider').find('.touchslider-nav li.center-block').append('<span class="circle touchslider-nav-item '+(key==0?'touchslider-nav-item-current':'')+'" > </span>');
                });
             
                //支持鼠标滑动
                $.browser = {};
                $.browser.mozilla = /firefox/.test(navigator.userAgent.toLowerCase());
                $.browser.webkit = /webkit/.test(navigator.userAgent.toLowerCase());
                $.browser.opera = /opera/.test(navigator.userAgent.toLowerCase());
                $.browser.msie = /msie/.test(navigator.userAgent.toLowerCase());

                $(".touchslider").touchSlider({
                    namespace: "touchslider",
                    autoplay: true,
                    mouseTouch: true,
                  /*  duration:1500,*/
                });
         $('.touchslider-viewport .touchslider-item').width(touchSliderImgWidth);
  

   var productAtt={

    "ATTR_LIST": [{
        "ATTR_VALUE": [ "银", "黑", "金"],
        "ATTR_NAME": "颜色",
        "PROD_ATTR_ID": 10001
    }, {
        "ATTR_VALUE": ["16G", "32G"],
        "ATTR_NAME": "内存",
        "PROD_ATTR_ID": 10002
    }],
    "PREMONEY": [{"VALUE":2,"NAME":'5000'}],
    "PAY_TYPE":[{"VALUE":1,"NAME":'分期付款'}],
    "SPEC_LIST": [{
        "PROD_SPEC_ID": "treeterter",
        "SPEC_PRICE": "4340",
        "PROD_SPEC": ["金", "32G"],
        "STORE": "50",
        "OFFER": [{
            "NAME": "不限量（全国版）199",
            "VALUE": 1
        }, {
            "NAME": "不限量（全国版）199",
            "VALUE": 8
        }, {
            "NAME": "不限量（全国版）399",
            "VALUE": 10
        }]
    }, {
        "PROD_SPEC_ID": "terter",
        "SPEC_PRICE": "0",
        "PROD_SPEC": ["黑", "32G"],
        "STORE": "0",
        "OFFER": [{
            "NAME": "不限量（全国版）199",
            "VALUE": 1
        }, {
            "NAME": "不限量（全国版）299",
            "VALUE": 8
        }, {
            "NAME": "不限量（全国版）399",
            "VALUE": 10
        }]
    }, {
        "PROD_SPEC_ID": "terter",
        "SPEC_PRICE": "4343",
        "PROD_SPEC": ["银", "32G"],
        "STORE": "43243",
        "OFFER": [{
            "NAME": "不限量（全国版）199",
            "VALUE": 1
        }, {
            "NAME": "不限量（全国版）199",
            "VALUE": 8
        }, {
            "NAME": "不限量（全国版）399",
            "VALUE": 10
        }]
    }, {
        "PROD_SPEC_ID": "teter",
        "SPEC_PRICE": "434",
        "PROD_SPEC": ["金", "16G"],
        "STORE": "434",
        "OFFER": [{
            "NAME": "不限量（全国版）199",
            "VALUE": 1
        }, {
            "NAME": "不限量（全国版）299",
            "VALUE": 8
        }, {
            "NAME": "不限量（全国版）399",
            "VALUE": 10
        }]
    }, {
        "PROD_SPEC_ID": "432reref",
        "SPEC_PRICE": "4340",
        "PROD_SPEC": ["银", "16G"],
        "STORE": "30",
        "OFFER": [{
            "NAME": "不限量（全国版）199",
            "VALUE": 1
        }, {
            "NAME": "不限量（全国版）299",
            "VALUE": 8
        }, {
            "NAME": "不限量（全国版）399",
            "VALUE": 10
        }]
    }, {
        "PROD_SPEC_ID": "ewrewvxc",
        "SPEC_PRICE": "32434",
        "PROD_SPEC": ["黑", "16G"],
        "STORE": "10",
        "OFFER": [{
            "NAME": "不限量（全国版）199",
            "VALUE": 1
        }, {
            "NAME": "不限量（全国版）299",
            "VALUE": 8
        }, {
            "NAME": "不限量（全国版）399",
            "VALUE": 10
        }]
    }
  
    ]
}


          var productAttSelect=function(options){
                    var defaults={
                        PAY_TYPE:[],
                        ATTR_LIST:[],
                        SPEC_LIST:[],
                        PREMONEY:[]
                    };
                    options=$.extend({}, defaults, options);
                  
                    var initComplete=false;

                    var getAttrValue=function(pid,vid){
                        return options['ATTR_LIST'][pid]['ATTR_VALUE'][vid];
                    }
                    var inObject=function(elem, arr){
                        var isIn=false;
                        $.each(arr,function(i,val){
                            if(val.name==elem){ isIn=true;return;}
                        });
                        return isIn;
                    }
                    var AZ=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]

                    var index={0:[]},storeIndexArr={},storeCount=0;
                    //遍历所有规格的商品
                    $.each(options.SPEC_LIST,function(key,item){
                        var iKey='';
                        storeCount+=Number(item.STORE);
                        //遍历某个产品规格
                        $.each(item.PROD_SPEC,function(k,val){
                            //取得规格在属性列表的位置
                            var sid= $.inArray(val,options['ATTR_LIST'][k]['ATTR_VALUE']);
                            iKey+=AZ[k]+sid;

                            //库存统计
                            if($.type(storeIndexArr[iKey])=='undefined'){
                                storeIndexArr[iKey]={store:Number(item['STORE'])};
                            }else{
                                storeIndexArr[iKey]['store']+=Number(item['STORE']);
                            }

                            //提取第一个属性，用来列出根下面的属性
                            if(k==0){
                                if($.type(index[0])=='undefined'){ index[0]=[];}
                                if(inObject(val,index[0])==false){
                                    index[0].push({'key':sid,name:val,'ikey':iKey});
                                }
                            }

                            if($.type(index[iKey])=='undefined'){ index[iKey]=[];}

                            //获取下一个值
                            var nextVal=$.type(item.PROD_SPEC[(k+1)])=='undefined'?false:item.PROD_SPEC[(k+1)];
                            //判断下一个值是否在索引中存在，如果不存在就在这个索引中push这个值，如果nextVal是个false那证明到了最底层，直接push最底层的那个key
                            if(inObject(nextVal,index[iKey])==false){
                                if(nextVal){
                                    var nextSid= $.inArray(nextVal,options['ATTR_LIST'][k+1]['ATTR_VALUE']);
                                    var nextIndexKey=iKey+AZ[k+1]+nextSid;

                                    index[iKey].push({'key':nextSid,name:nextVal,'ikey':nextIndexKey});
                                }else{
                                    index[iKey]=key;
                                }
                            }
                        })
                    });

                    //遍历出所有属性
                    $.each(options.ATTR_LIST,function(key,val){
                        $('.attribute tbody').append('<tr data-key="'+AZ[key]+'"><th>'+val.ATTR_NAME+'：</th><td></td></tr>');
                    });

                    $('.attribute').on('click','td span',function(){
                        if(initComplete==true){
                            if($(this).hasClass('d')){ return false;}
                        }
                        $(this).parent().find('span').removeClass('selected');
                        $(this).addClass('selected');

                        //处理扩展
                        if($.type(productAtt.extCallBack)=='function'){
                            productAtt.extCallBack($(this));
                        }

                        var currentLevel=$(this).parents('tr').first().index();
                        var tbodyObj=$(this).parents('tbody').first();
                        var nodeKey='';
                        for(var i=0;i<=currentLevel;i++){
                            nodeKey+=tbodyObj.find('tr').eq(i).attr('data-key')+tbodyObj.find('tr').eq(i).find('td span.selected').attr('data-key');
                        }

                        if($.type($(this).attr('data-val'))=='string'){
                            $(this).parents('tr').first().find('input').val($(this).attr('data-val'));
                        }

                        if($.type(index[nodeKey])=='number'){
                            //如果没配制库存则隐藏库存属性
                            if(options['SPEC_LIST'][index[nodeKey]]['OFFER'].length>0){
                                $('.attribute .offer').show();
                            }else{
                                $('.attribute .offer').hide();
                            }

                            $('.attribute .price').find('.red').html(options['SPEC_LIST'][index[nodeKey]]['SPEC_PRICE']);
                            $('.attribute .price').find('input[name=spec_id]').val(options['SPEC_LIST'][index[nodeKey]]['SPEC_PRICE']).attr('data-index',index[nodeKey])
                            //是否显示库存
                            if($.type(options['SPEC_LIST'][index[nodeKey]]['STORE'])!='undefined'){
                                $('.attribute .store').show().find('.txt').html(options['SPEC_LIST'][index[nodeKey]]['STORE']);
                            }

                            initAttributeValue2($('.attribute .offer'),options['SPEC_LIST'][index[nodeKey]]['OFFER']);
                            return;
                        }

                        if((currentLevel+1)<tbodyObj.find('tr').length){
                            initAttributeValue(tbodyObj.find('tr').eq(currentLevel+1),index[nodeKey]);
                        }
                    });

                    var getCountStore=function(ikey){
                        return storeIndexArr[ikey]['store']
                    }
                    var initAttributeValue=function(trObj,data){

                        var itemHtml='';
                        $.each(data,function(k,val){
                            var swc=getCountStore(val.ikey)>0?'e':'d';
                            itemHtml+='<span class="'+swc+'" data-key="'+val.key+'">'+val.name+'</span>';
                        });
                         
                        trObj.find('td').html(itemHtml);
                        if(trObj.find('td span.e').length>0){
                            trObj.find('td span.e').first().click();
                        }else{
                            trObj.find('td span:eq(0)').click();
                        }
                    };
                    var initAttributeValue2=function(trObj,data){
                        var itemHtml='';
                        $.each(data,function(k,val){
                            itemHtml+='<span data-val="'+val.VALUE+'">'+val.NAME+'</span>';
                        });
                        trObj.find('td').html(itemHtml);
                        trObj.find('td span:eq(0)').click();
                    };

                    initAttributeValue($('.attribute tbody tr').eq(0),index[0]);

                    initAttributeValue2($('.attribute .payType'),options.PAY_TYPE);
                   
                    initAttributeValue2($('.attribute .premoney'),options.PREMONEY);

                    //库存为0所有选项变灰
              
                   if(storeCount<1){
                        $('.attribute thead td span').addClass('d');
                        $('.attribute tfoot td span').addClass('d');
                      
                    }
                    initComplete=true;
                }

                productAttSelect(productAtt);

                $(".product-detail .cut .row > div").click(function(){
                    $(this).parents('.cut').find('div').removeClass('selected');
                    $(this).addClass('selected');
                    $(this).parents('.cut').find('.content .cut_c').hide();
                    $(this).parents('.cut').find('.content .'+$(this).attr('id')).fadeIn(1000);
                    $('html, body').animate({scrollTop: '800px'}, 600);
                });

            });

        </script>

